"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[842],{6880(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"design-decisions","title":"Design Decisions","description":"This document captures key architectural and technical decisions made for the RepeatNoMore project.","source":"@site/docs/design-decisions.md","sourceDirName":".","slug":"/design-decisions","permalink":"/RepeatNoMore/docs/design-decisions","draft":false,"unlisted":false,"editUrl":"https://github.com/zskreisz/RepeatNoMore/tree/main/docs-site/docs/design-decisions.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Customization","permalink":"/RepeatNoMore/docs/customization"}}');var r=i(4848),t=i(8453);const l={sidebar_position:5},o="Design Decisions",c={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Development Environment",id:"development-environment",level:2},{value:"Package Management: UV",id:"package-management-uv",level:3},{value:"Python Version",id:"python-version",level:3},{value:"Programming Style",id:"programming-style",level:2},{value:"Type Hints",id:"type-hints",level:3},{value:"Functional Programming",id:"functional-programming",level:3},{value:"Architecture Patterns",id:"architecture-patterns",level:2},{value:"Singleton Pattern for Global Resources",id:"singleton-pattern-for-global-resources",level:3},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Agent Pattern",id:"agent-pattern",level:3},{value:"Technology Choices",id:"technology-choices",level:2},{value:"Vector Database: PostgreSQL + pgvector",id:"vector-database-postgresql--pgvector",level:3},{value:"LLM: Cloud API Providers",id:"llm-cloud-api-providers",level:3},{value:"Web Framework: FastAPI",id:"web-framework-fastapi",level:3},{value:"Testing Strategy",id:"testing-strategy",level:2},{value:"Test Organization",id:"test-organization",level:3},{value:"Testing Principles",id:"testing-principles",level:3},{value:"Coverage Goals",id:"coverage-goals",level:3},{value:"Code Organization",id:"code-organization",level:2},{value:"Module Structure",id:"module-structure",level:3},{value:"Import Style",id:"import-style",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Lazy Loading",id:"lazy-loading",level:3},{value:"Caching",id:"caching",level:3},{value:"Batch Processing",id:"batch-processing",level:3},{value:"Security Principles",id:"security-principles",level:2},{value:"Input Validation",id:"input-validation",level:3},{value:"Secrets Management",id:"secrets-management",level:3},{value:"Logging and Monitoring",id:"logging-and-monitoring",level:2},{value:"Structured Logging",id:"structured-logging",level:3},{value:"Metrics",id:"metrics",level:3},{value:"Documentation Standards",id:"documentation-standards",level:2},{value:"Docstring Format: Google Style",id:"docstring-format-google-style",level:3},{value:"Code Comments",id:"code-comments",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Exceptions",id:"exceptions",level:3},{value:"Error Context",id:"error-context",level:3},{value:"Future Considerations",id:"future-considerations",level:2},{value:"Potential Changes",id:"potential-changes",level:3},{value:"Deferred Decisions",id:"deferred-decisions",level:3},{value:"References",id:"references",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"design-decisions",children:"Design Decisions"})}),"\n",(0,r.jsx)(n.p,{children:"This document captures key architectural and technical decisions made for the RepeatNoMore project."}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#development-environment",children:"Development Environment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#programming-style",children:"Programming Style"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#architecture-patterns",children:"Architecture Patterns"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#technology-choices",children:"Technology Choices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#testing-strategy",children:"Testing Strategy"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"development-environment",children:"Development Environment"}),"\n",(0,r.jsx)(n.h3,{id:"package-management-uv",children:"Package Management: UV"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use ",(0,r.jsx)(n.code,{children:"uv"})," for development environment and package management."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Speed"}),": ",(0,r.jsx)(n.code,{children:"uv"})," is significantly faster than pip for dependency resolution and installation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reliability"}),": Better dependency resolution and lock file management"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Modern"}),": Written in Rust, actively maintained, follows modern Python packaging standards"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compatibility"}),": Drop-in replacement for pip with better performance"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Install uv\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Create virtual environment\nuv venv\n\n# Install dependencies\nuv pip install -r requirements.txt\n\n# Add new package\nuv pip install <package>\n\n# Sync dependencies\nuv pip sync requirements.txt\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"References:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/astral-sh/uv",children:"uv Documentation"})}),"\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"https://github.com/zskreisz/RepeatNoMore/blob/main/CLAUDE.md",children:"CLAUDE.md"})," for development guidelines"]}),"\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"https://github.com/zskreisz/RepeatNoMore/blob/main/copilot-instructions.md",children:"copilot-instructions.md"})," for coding patterns"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"python-version",children:"Python Version"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Python 3.11+"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Modern type system features"}),"\n",(0,r.jsx)(n.li,{children:"Performance improvements over 3.10"}),"\n",(0,r.jsx)(n.li,{children:"Good ecosystem support"}),"\n",(0,r.jsx)(n.li,{children:"Compatible with most AI/ML libraries"}),"\n",(0,r.jsx)(n.li,{children:"Avoids issues with packages requiring <3.12"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"programming-style",children:"Programming Style"}),"\n",(0,r.jsx)(n.h3,{id:"type-hints",children:"Type Hints"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Comprehensive use of type hints throughout the codebase."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guidelines:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from typing import Optional, List, Dict, Any, Callable\nfrom collections.abc import Iterable\n\n# Always use type hints for function signatures\ndef process_documents(\n    texts: List[str],\n    metadata: Optional[Dict[str, Any]] = None,\n    batch_size: int = 32\n) -> List[Dict[str, Any]]:\n    """Process documents with type-safe interface."""\n    pass\n\n# Use TypeAlias for complex types\nfrom typing import TypeAlias\n\nDocumentBatch: TypeAlias = List[Dict[str, Any]]\nEmbeddingVector: TypeAlias = List[float]\n\n# Use generics when appropriate\nfrom typing import Generic, TypeVar\n\nT = TypeVar(\'T\')\n\nclass Cache(Generic[T]):\n    def get(self, key: str) -> Optional[T]:\n        pass\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"IDE autocomplete and IntelliSense"}),"\n",(0,r.jsx)(n.li,{children:"Early error detection"}),"\n",(0,r.jsx)(n.li,{children:"Better code documentation"}),"\n",(0,r.jsx)(n.li,{children:"Enables static type checking with mypy"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"functional-programming",children:"Functional Programming"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Functional programming style is welcome and encouraged."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guidelines:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["1. Use ",(0,r.jsx)(n.code,{children:"functools"})," utilities:"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from functools import reduce, partial, lru_cache, wraps\n\n# Caching\n@lru_cache(maxsize=128)\ndef get_embedding_model(model_name: str):\n    return load_model(model_name)\n\n# Partial application\nfrom operator import add\nadd_ten = partial(add, 10)\n\n# Reduce for aggregations\ntotal = reduce(lambda acc, x: acc + x, numbers, 0)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Prefer immutability:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Good: Return new objects\ndef add_metadata(doc: Document, key: str, value: Any) -> Document:\n    return Document(\n        content=doc.content,\n        metadata={**doc.metadata, key: value}\n    )\n\n# Avoid: Mutating in place\ndef add_metadata_bad(doc: Document, key: str, value: Any) -> None:\n    doc.metadata[key] = value  # Mutation\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Use comprehensions and generators:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# List comprehension\nvalid_docs = [doc for doc in documents if doc.is_valid()]\n\n# Generator for memory efficiency\ndef process_large_dataset(items: Iterable[str]) -> Iterable[Dict]:\n    return (process_item(item) for item in items)\n\n# Dict comprehension\nmetadata_dict = {doc.id: doc.metadata for doc in documents}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Higher-order functions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from typing import Callable\n\ndef apply_transformation(\n    items: List[T],\n    transform: Callable[[T], R]\n) -> List[R]:\n    return list(map(transform, items))\n\n# Use with lambda or partial\nresults = apply_transformation(\n    documents,\n    lambda doc: extract_features(doc)\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"5. Composition over inheritance:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from typing import Protocol\n\n# Use protocols for structural typing\nclass Embeddable(Protocol):\n    def to_embedding(self) -> List[float]: ...\n\nclass Retrievable(Protocol):\n    def retrieve(self, query: str) -> List[Document]: ...\n\n# Compose functionality\nclass RAGSystem:\n    def __init__(\n        self,\n        embedder: Embeddable,\n        retriever: Retrievable\n    ):\n        self.embedder = embedder\n        self.retriever = retriever\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to avoid functional style:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Performance-critical tight loops"}),"\n",(0,r.jsx)(n.li,{children:"When mutability is clearer (e.g., building large structures)"}),"\n",(0,r.jsx)(n.li,{children:"Interfacing with imperative APIs"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"architecture-patterns",children:"Architecture Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"singleton-pattern-for-global-resources",children:"Singleton Pattern for Global Resources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use singleton pattern for expensive resources (vector stores, embeddings, agents)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Avoid multiple model loads"}),"\n",(0,r.jsx)(n.li,{children:"Share connections efficiently"}),"\n",(0,r.jsx)(n.li,{children:"Consistent state across application"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from typing import Optional\n\n_instance: Optional[ResourceType] = None\n\ndef get_instance() -> ResourceType:\n    global _instance\n    if _instance is None:\n        _instance = ResourceType()\n    return _instance\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use constructor injection for dependencies."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class QAAgent:\n    def __init__(\n        self,\n        retriever: Optional[Retriever] = None,\n        llm_client: Optional[LLMClient] = None\n    ):\n        self.retriever = retriever or get_retriever()\n        self.llm_client = llm_client or get_llm_client()\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Testability (easy to mock)"}),"\n",(0,r.jsx)(n.li,{children:"Flexibility (swap implementations)"}),"\n",(0,r.jsx)(n.li,{children:"Explicit dependencies"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"agent-pattern",children:"Agent Pattern"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use agent-based architecture with base classes."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from abc import ABC, abstractmethod\n\nclass BaseAgent(ABC):\n    @abstractmethod\n    def process(self, input_data: Dict[str, Any]) -> AgentResult:\n        pass\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Extensibility (add new agents easily)"}),"\n",(0,r.jsx)(n.li,{children:"Consistency (common interface)"}),"\n",(0,r.jsx)(n.li,{children:"Testability (mock agents)"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"technology-choices",children:"Technology Choices"}),"\n",(0,r.jsx)(n.h3,{id:"vector-database-postgresql--pgvector",children:"Vector Database: PostgreSQL + pgvector"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," PostgreSQL with pgvector extension as the primary vector database."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unified storage"}),": Single database for both relational and vector data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mature ecosystem"}),": Well-established PostgreSQL tooling and management"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Azure integration"}),": Azure Database for PostgreSQL Flexible Server with pgvector support"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cost effective"}),": No additional vector database service needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SQL flexibility"}),": Full SQL capabilities alongside vector search"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Production ready"}),": Battle-tested PostgreSQL with ACID guarantees"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uses cosine distance operator (",(0,r.jsx)(n.code,{children:"<=>"}),") for similarity search"]}),"\n",(0,r.jsx)(n.li,{children:"HNSW indexing for efficient approximate nearest neighbor search"}),"\n",(0,r.jsx)(n.li,{children:"JSONB for flexible metadata storage"}),"\n",(0,r.jsx)(n.li,{children:"1536 dimensions for text-embedding-3-small embeddings"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Alternatives considered:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ChromaDB (rejected - requires separate service)"}),"\n",(0,r.jsx)(n.li,{children:"Pinecone (requires cloud service, additional cost)"}),"\n",(0,r.jsx)(n.li,{children:"Weaviate (more complex setup)"}),"\n",(0,r.jsx)(n.li,{children:"FAISS (no persistence layer)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"llm-cloud-api-providers",children:"LLM: Cloud API Providers"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use cloud LLM APIs (Anthropic, OpenAI, Cursor) instead of local models."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Higher quality"}),": Access to latest frontier models (Claude, GPT-4)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No infrastructure"}),": No need to manage GPU resources"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cost effective"}),": Pay-per-use for occasional queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Easier deployment"}),": No model downloads or VRAM requirements"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flexibility"}),": Easy to switch between providers"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Supported providers:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Anthropic (Claude models) - default"}),"\n",(0,r.jsx)(n.li,{children:"OpenAI (GPT-4 models)"}),"\n",(0,r.jsx)(n.li,{children:"Cursor (for IDE integration)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"LLM_PROVIDER=anthropic  # or openai, cursor\nANTHROPIC_API_KEY=sk-...\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Alternatives considered:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ollama + Mistral (previous choice - local but resource intensive)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"web-framework-fastapi",children:"Web Framework: FastAPI"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," FastAPI for REST API."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Async support (important for LLM calls)"}),"\n",(0,r.jsx)(n.li,{children:"Automatic OpenAPI docs"}),"\n",(0,r.jsx)(n.li,{children:"Pydantic integration"}),"\n",(0,r.jsx)(n.li,{children:"High performance"}),"\n",(0,r.jsx)(n.li,{children:"Type hints first-class"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"testing-strategy",children:"Testing Strategy"}),"\n",(0,r.jsx)(n.h3,{id:"test-organization",children:"Test Organization"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"tests/\n\u251c\u2500\u2500 unit/          # Fast, isolated tests\n\u251c\u2500\u2500 integration/   # Component interaction tests\n\u251c\u2500\u2500 e2e/          # End-to-end workflows\n\u2514\u2500\u2500 conftest.py   # Shared fixtures\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-principles",children:"Testing Principles"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Fast unit tests:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def test_embed_text(generator):\n    """Test should run in <1ms"""\n    embedding = generator.embed_text("test")\n    assert len(embedding) == 768\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Integration tests marked:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@pytest.mark.integration\ndef test_full_rag_pipeline():\n    """Test actual services (slower)"""\n    pass\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Mock external services in unit tests:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"@patch('app.rag.embeddings.SentenceTransformer')\ndef test_with_mock(mock_model):\n    mock_model.return_value.encode.return_value = [0.1] * 768\n    # Test code\n"})}),"\n",(0,r.jsx)(n.h3,{id:"coverage-goals",children:"Coverage Goals"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Unit tests"}),": >80% coverage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration tests"}),": Critical paths covered"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"E2E tests"}),": Happy paths covered"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"code-organization",children:"Code Organization"}),"\n",(0,r.jsx)(n.h3,{id:"module-structure",children:"Module Structure"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Organize by feature/component, not by type."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"app/\n\u251c\u2500\u2500 rag/          # All RAG-related code\n\u251c\u2500\u2500 agents/       # All agent code\n\u251c\u2500\u2500 api/          # All API code\n\u2514\u2500\u2500 utils/        # Shared utilities\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Not:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"app/\n\u251c\u2500\u2500 models/       # Don't organize by technical layer\n\u251c\u2500\u2500 services/\n\u2514\u2500\u2500 controllers/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"import-style",children:"Import Style"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guidelines:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Standard library\nimport os\nimport time\nfrom typing import List, Optional\n\n# Third-party\nimport numpy as np\nfrom fastapi import FastAPI\n\n# Local application\nfrom app.config import get_settings\nfrom app.rag.embeddings import get_embedding_generator\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"lazy-loading",children:"Lazy Loading"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Lazy-load expensive resources."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class EmbeddingGenerator:\n    def __init__(self):\n        self._model = None\n\n    @property\n    def model(self):\n        if self._model is None:\n            self._model = load_expensive_model()\n        return self._model\n"})}),"\n",(0,r.jsx)(n.h3,{id:"caching",children:"Caching"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use ",(0,r.jsx)(n.code,{children:"@lru_cache"})," for pure functions."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from functools import lru_cache\n\n@lru_cache(maxsize=1000)\ndef get_similar_docs(query: str, top_k: int) -> List[Document]:\n    # Expensive operation\n    pass\n"})}),"\n",(0,r.jsx)(n.h3,{id:"batch-processing",children:"Batch Processing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Process in batches where possible."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def embed_batch(texts: List[str], batch_size: int = 32):\n    for i in range(0, len(texts), batch_size):\n        batch = texts[i:i + batch_size]\n        yield process_batch(batch)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"security-principles",children:"Security Principles"}),"\n",(0,r.jsx)(n.h3,{id:"input-validation",children:"Input Validation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Validate all external input with Pydantic."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from pydantic import BaseModel, Field, validator\n\nclass QuestionRequest(BaseModel):\n    question: str = Field(..., min_length=1, max_length=1000)\n\n    @validator('question')\n    def sanitize_question(cls, v):\n        # Remove null bytes, etc.\n        return v.replace('\\x00', '')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"secrets-management",children:"Secrets Management"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Never commit secrets; use environment variables."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guidelines:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All secrets in ",(0,r.jsx)(n.code,{children:".env"})," (gitignored)"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:".env.example"})," as template"]}),"\n",(0,r.jsx)(n.li,{children:"Mask sensitive data in logs"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"logging-and-monitoring",children:"Logging and Monitoring"}),"\n",(0,r.jsx)(n.h3,{id:"structured-logging",children:"Structured Logging"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use structlog for structured logging."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from app.utils.logging import get_logger\n\nlogger = get_logger(__name__)\n\nlogger.info(\n    "document_indexed",\n    doc_id=doc_id,\n    size=len(content),\n    processing_time=duration\n)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Machine-readable logs"}),"\n",(0,r.jsx)(n.li,{children:"Easy to query"}),"\n",(0,r.jsx)(n.li,{children:"Contextual information"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Prometheus for metrics."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What to track:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request counts and latency"}),"\n",(0,r.jsx)(n.li,{children:"LLM call duration"}),"\n",(0,r.jsx)(n.li,{children:"Vector store operations"}),"\n",(0,r.jsx)(n.li,{children:"Error rates"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"documentation-standards",children:"Documentation Standards"}),"\n",(0,r.jsx)(n.h3,{id:"docstring-format-google-style",children:"Docstring Format: Google Style"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def process_document(\n    content: str,\n    metadata: Optional[Dict[str, Any]] = None\n) -> Document:\n    """\n    Process a document and create chunks.\n\n    Args:\n        content: The document text content\n        metadata: Optional metadata dictionary\n\n    Returns:\n        Document: Processed document with chunks\n\n    Raises:\n        ValueError: If content is empty\n\n    Example:\n        >>> doc = process_document("Hello world")\n        >>> print(doc.chunks)\n    """\n    pass\n'})}),"\n",(0,r.jsx)(n.h3,{id:"code-comments",children:"Code Comments"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to comment:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Complex algorithms"}),"\n",(0,r.jsx)(n.li,{children:"Non-obvious workarounds"}),"\n",(0,r.jsx)(n.li,{children:"Performance optimizations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When not to comment:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Obvious code"}),"\n",(0,r.jsx)(n.li,{children:"Type hints convey the information"}),"\n",(0,r.jsx)(n.li,{children:"Self-documenting function names"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.h3,{id:"exceptions",children:"Exceptions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Use specific exceptions, not generic ",(0,r.jsx)(n.code,{children:"Exception"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guidelines:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Good\nraise ValueError("Query cannot be empty")\nraise FileNotFoundError(f"Document not found: {doc_id}")\n\n# Bad\nraise Exception("Something went wrong")\n'})}),"\n",(0,r.jsx)(n.h3,{id:"error-context",children:"Error Context"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Decision:"})," Always log errors with context."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'try:\n    result = process_document(doc)\nexcept Exception as e:\n    logger.error(\n        "document_processing_failed",\n        doc_id=doc.id,\n        error=str(e),\n        error_type=type(e).__name__\n    )\n    raise\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"future-considerations",children:"Future Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"potential-changes",children:"Potential Changes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Async everywhere"}),": Move more code to async/await"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"gRPC"}),": Consider gRPC for internal services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Distributed tracing"}),": Add OpenTelemetry"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-tenancy"}),": Separate collections per tenant"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"deferred-decisions",children:"Deferred Decisions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Message queue (if needed for scaling)"}),"\n",(0,r.jsx)(n.li,{children:"Caching layer (Redis)"}),"\n",(0,r.jsx)(n.li,{children:"Database for persistent state"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/zskreisz/RepeatNoMore/blob/main/CLAUDE.md",children:"CLAUDE.md"})," - Development guidelines for AI assistants"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/zskreisz/RepeatNoMore/blob/main/copilot-instructions.md",children:"copilot-instructions.md"})," - Coding patterns and examples"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/zskreisz/RepeatNoMore/blob/main/README.md",children:"README.md"})," - Project overview and setup"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/getting-started",children:"QUICKSTART.md"})," - Getting started guide"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Document Version:"})," 1.1\n",(0,r.jsx)(n.strong,{children:"Last Updated:"})," 2026-01-27\n",(0,r.jsx)(n.strong,{children:"Maintainers:"})," RepeatNoMore Team"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);